<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>å¾·ä¸­å–®å­—è¤‡ç¿’å™¨ï¼ˆé¸æ“‡é¡Œ + å³æ™‚é¡¯ç¤ºéŒ¯é¡Œï¼‰</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .card { margin-top: 20px; font-size: 20px; }
    #answer, #choiceArea { margin-top: 10px; }
    button { margin-top: 10px; }
    #choiceArea button { margin: 3px; }
    #wrongList {
      margin-top: 30px;
      padding: 10px;
      border-top: 2px solid #ccc;
    }
    #wrongList h2 {
      margin-top: 0;
    }
    #wrongList ul {
      list-style: none;
      padding-left: 0;
    }
    #wrongList li {
      padding: 4px 0;
      color: red;
    }
  </style>
</head>
<body>
  <h1>å¾·ä¸­å–®å­—è¤‡ç¿’å™¨</h1>
  <textarea id="wordInput" placeholder="è«‹è¼¸å…¥å–®å­—ï¼Œæ¯è¡Œä¸€çµ„ï¼šå¾·æ–‡ï¼šä¸­æ–‡" rows="8" cols="40"></textarea><br>

  <button onclick="startReview()">é–‹å§‹è¤‡ç¿’</button>
  <button onclick="toggleMode()">åˆ‡æ›æ¨¡å¼ï¼ˆç›®å‰ï¼šè‡ªç”±è¼¸å…¥ï¼‰</button>
  <button onclick="clearWrong()">æ¸…ç©ºéŒ¯é¡Œåˆ—è¡¨</button>

  <div class="card" id="questionArea" style="display:none;">
    <p id="questionText"></p>
    <input id="answer" placeholder="è¼¸å…¥å¾·æ–‡ç­”æ¡ˆ" style="display:inline;" />
    <div id="choiceArea" style="display:none;"></div>
    <button onclick="checkAnswer()">æª¢æŸ¥</button>
    <p id="result"></p>
  </div>

  <div id="wrongList" style="display:none;">
    <h2>éŒ¯é¡Œæ¸…å–®ï¼ˆç­”éŒ¯éçš„å–®å­—ï¼‰</h2>
    <ul id="wrongItems"></ul>
  </div>

<script>
  let allCards = [];
  let reviewList = [];
  let wrongCards = [];
  let currentCard = null;
  let isMultipleChoice = false;

  window.onload = () => {
    const saved = localStorage.getItem('vocab');
    if (saved) document.getElementById('wordInput').value = saved;
  };

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function startReview() {
    const rawInput = document.getElementById('wordInput').value.trim();
    if (!rawInput) {
      alert("è«‹å…ˆè¼¸å…¥å–®å­—ï¼");
      return;
    }
    localStorage.setItem('vocab', rawInput);

    const lines = rawInput.split('\n');
    allCards = lines.map(line => {
      const [de, zh] = line.split('ï¼š');
      return { de: de.trim(), zh: zh.trim() };
    });

    reviewList = shuffle([...allCards]);
    wrongCards = [];
    updateWrongList();
    document.getElementById('questionArea').style.display = 'block';
    document.getElementById('result').innerText = "";
    showQuestion();
  }

  function toggleMode() {
    isMultipleChoice = !isMultipleChoice;
    document.getElementById('answer').value = "";
    document.getElementById('result').innerText = "";
    if (isMultipleChoice) {
      document.getElementById('choiceArea').style.display = 'block';
      document.getElementById('answer').style.display = 'none';
      alert('å·²åˆ‡æ›åˆ°é¸æ“‡é¡Œæ¨¡å¼');
    } else {
      document.getElementById('choiceArea').style.display = 'none';
      document.getElementById('answer').style.display = 'inline';
      alert('å·²åˆ‡æ›åˆ°è‡ªç”±è¼¸å…¥æ¨¡å¼');
    }
    if (reviewList.length > 0) showQuestion();
  }

  function showQuestion() {
    if (reviewList.length === 0) {
      document.getElementById('questionText').innerText = "ğŸ‰ è¤‡ç¿’å®Œç•¢ï¼";
      document.getElementById('answer').style.display = 'none';
      document.getElementById('choiceArea').style.display = 'none';
      return;
    }

    currentCard = reviewList[0];
    document.getElementById('questionText').innerText = `è«‹è¼¸å…¥ã€Œ${currentCard.zh}ã€çš„å¾·æ–‡ï¼š`;
    document.getElementById('result').innerText = "";
    if (isMultipleChoice) {
      showChoices();
    } else {
      document.getElementById('answer').value = "";
      document.getElementById('answer').style.display = 'inline';
      document.getElementById('choiceArea').style.display = 'none';
    }
  }

  function showChoices() {
    const choiceArea = document.getElementById('choiceArea');
    choiceArea.innerHTML = '';

    let choices = [currentCard.de];
    const wrongs = allCards.filter(c => c.de !== currentCard.de);
    shuffle(wrongs);
    for (let i = 0; i < 3 && i < wrongs.length; i++) {
      choices.push(wrongs[i].de);
    }
    shuffle(choices);

    choices.forEach(choice => {
      const btn = document.createElement('button');
      btn.textContent = choice;
      btn.onclick = () => {
        document.getElementById('answer').value = choice;
      };
      choiceArea.appendChild(btn);
    });

    choiceArea.style.display = 'block';
    document.getElementById('answer').style.display = 'none';
  }

  function checkAnswer() {
    let userAnswer;
    if (isMultipleChoice) {
      userAnswer = document.getElementById('answer').value.trim();
      if (!userAnswer) {
        alert('è«‹å…ˆå¾é¸é …æŒ‰éˆ•é¸æ“‡ç­”æ¡ˆ');
        return;
      }
    } else {
      userAnswer = document.getElementById('answer').value.trim();
    }

    const correct = currentCard.de;

    if (userAnswer.toLowerCase() === correct.toLowerCase()) {
      document.getElementById('result').innerText = "âœ… æ­£ç¢ºï¼";
      reviewList.shift();
    } else {
      document.getElementById('result').innerText = `âŒ éŒ¯äº†ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${correct}`;
      if (!wrongCards.find(c => c.de === currentCard.de)) {
        wrongCards.push(currentCard);
        updateWrongList();
      }
      reviewList.push(reviewList.shift());
    }

    setTimeout(() => {
      document.getElementById('result').innerText = "";
      showQuestion();
    }, 1400);
  }

  function updateWrongList() {
    const wrongDiv = document.getElementById('wrongList');
    const ul = document.getElementById('wrongItems');
    if (wrongCards.length === 0) {
      wrongDiv.style.display = 'none';
      ul.innerHTML = '';
    } else {
      wrongDiv.style.display = 'block';
      ul.innerHTML = wrongCards.map(c => `<li>${c.de} ï¼š ${c.zh}</li>`).join('');
    }
  }

  function clearWrong() {
    wrongCards = [];
    updateWrongList();
  }
</script>
</body>
</html>
